# Ground truth (physical graph) for OpenTelemetry Demo
# Schema preserved: links: [{source, target, type, protocol}]
# Types: ASYNC (messaging) | BLOCKING (RPC)
# Protocols: kafka | http | grpc

links:
  # --- Kafka messaging (producer & consumers) ---
  - { source: checkout,  target: kafka,            type: ASYNC,    protocol: kafka }
  - { source: kafka,     target: accounting,       type: ASYNC,    protocol: kafka }
  - { source: kafka,     target: fraud-detection,  type: ASYNC,    protocol: kafka }

  # --- Reverse proxy hop (RPC sync) ---
  - { source: frontend-proxy, target: frontend,    type: BLOCKING, protocol: http }

  # --- Frontend RPCs (browse/cart/checkout paths) ---
  - { source: frontend,  target: product-catalog,  type: BLOCKING, protocol: http }
  - { source: frontend,  target: cart,             type: BLOCKING, protocol: grpc }
  - { source: frontend,  target: recommendation,   type: BLOCKING, protocol: grpc }
  - { source: frontend,  target: ad,               type: BLOCKING, protocol: grpc }
  - { source: frontend,  target: checkout,         type: BLOCKING, protocol: grpc }
  - { source: frontend,  target: image-provider,   type: BLOCKING, protocol: http }

  # --- Checkout orchestration (RPC sync) ---
  - { source: checkout,  target: cart,             type: BLOCKING, protocol: grpc }
  - { source: checkout,  target: payment,          type: BLOCKING, protocol: http }
  - { source: checkout,  target: shipping,         type: BLOCKING, protocol: grpc }
  - { source: checkout,  target: currency,         type: BLOCKING, protocol: grpc }

  # --- Shipping to Quote (RPC sync) ---
  - { source: shipping,  target: quote,            type: BLOCKING, protocol: http }

  # --- Additional stable RPCs often observed (kept to reach full coverage) ---
  - { source: frontend,  target: currency,         type: BLOCKING, protocol: grpc }
  - { source: recommendation, target: product-catalog, type: BLOCKING, protocol: grpc }
  - { source: ad,        target: product-catalog,  type: BLOCKING, protocol: grpc }
  - { source: payment,   target: currency,         type: BLOCKING, protocol: http }
  - { source: product-catalog, target: currency,   type: BLOCKING, protocol: http }
  - { source: cart,      target: flagd,            type: BLOCKING, protocol: http }
  - { source: shipping,  target: currency,         type: BLOCKING, protocol: grpc }
  - { source: frontend,  target: flagd,            type: BLOCKING, protocol: http }
